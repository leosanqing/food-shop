# 前言

随着项目的发展，我们的用户数据越来越多，互联网企业也越来越重视这些数据，但是这些数据会给我们的系统带来很大的烦恼。因为这些海量的数据的存储和访问成了我们的瓶颈。我们使用传统的单库拓展起来非常的困难。

但是由于数据库厂商提供数据切分，拓展的服务需要收费，所以我们就采用第三方的软件来进行上述操作。

# 数据切分

数据切分，通过某种手段，将之前存储在一台数据库上的数据，分散到多台数据库中，从而达到降低单台数据库负载的效果。



## 垂直切分

将不同的表或者不同的不同的 schema 切分到不同的数据库中。比我们的订单表order和用户表user之前在同一个数据库中。现在我们把这两个表存储在不同机器上的不同数据库中，这样我们的单个数据库的负载就会降低很多

### 优点

- 拆分后业务清晰，拆分规则明确
- 系统之间容易拓展和整合
- 数据维护简单

### 缺点

- 部分业务无法join 连表查询，只能通过接口调用，提升了系统的复杂度
- 跨库事务难以处理
- 垂直切分后，某些业务数据过于庞大，仍然存在单体性能瓶颈。比如我们的order表

## 水平切分

水平切分相比垂直切分更复杂，因为垂直切分是不同的表拆出来，逻辑比较清楚。但是水平切分是把存储在同一个表中的数据按照一定规则把它存储在不同的表中。

那么怎么选取切分的规则就比较麻烦了。常见的规则：用户id取模；按照日期拆分数据；按照其他字段取模，拆分数据

### 优点

- 解决了单库大数据高并发的性能瓶颈
- 拆分规则封装好，对应用端几乎透明，开发人员无需关心拆分细节
- 提高了系统的稳定性和负载能力

### 缺点

- 拆分规则难以抽象
- 分片事务一致性难以解决
- 二次拓展时，数据迁移、维护难度大。

# 两种思路

- 客户端模式

  - 在每个应用模块内，配置自己需要的数据源，直接访问数据库，在各个模块内完后数据的整合
  - 代表 sharding-jdbc

- 中间代理模式

  - 中间代理统一管理所有的数据源，数据库层对开发人员完全透明，开发人员无需关注拆分的细节
  - 代表 Mycat

  